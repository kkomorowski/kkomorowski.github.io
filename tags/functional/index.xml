<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Functional on hiquality.dev</title>
    <link>https://hiquality.dev/tags/functional/</link>
    <description>Recent content in Functional on hiquality.dev</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 20 Feb 2024 19:45:00 +0100</lastBuildDate>
    <atom:link href="https://hiquality.dev/tags/functional/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Automated Acceptance Tests with ScalaTest</title>
      <link>https://hiquality.dev/posts/automated-acceptance-tests-with-scalatest/</link>
      <pubDate>Tue, 20 Feb 2024 19:45:00 +0100</pubDate>
      <guid>https://hiquality.dev/posts/automated-acceptance-tests-with-scalatest/</guid>
      <summary>&lt;p&gt;Almost seven years ago I&amp;rsquo;ve started a new and unexpected journey. Back then&#xA;I had some experience with test automation in Python and Java and I&amp;rsquo;ve joined&#xA;the team working on the backend application written in Scala. It was my first&#xA;experience with functional programming so I was wondering if&#xA;it would not be hard to learn and maintain the test suite written in this&#xA;new for me language. It turned out that it&amp;rsquo;s not and the work with Scala&#xA;gave me a lot of fun.&lt;/p&gt;&#xA;&lt;p&gt;In this first episode of the blog post series I would like to show how&#xA;to start testing a REST API using ScalaTest and how to use some more&#xA;advanced features of this one of the most popular Scala-based test frameworks.&lt;/p&gt;</summary>
      <description>&lt;p&gt;Almost seven years ago I&amp;rsquo;ve started a new and unexpected journey. Back then&#xA;I had some experience with test automation in Python and Java and I&amp;rsquo;ve joined&#xA;the team working on the backend application written in Scala. It was my first&#xA;experience with functional programming so I was wondering if&#xA;it would not be hard to learn and maintain the test suite written in this&#xA;new for me language. It turned out that it&amp;rsquo;s not and the work with Scala&#xA;gave me a lot of fun.&lt;/p&gt;&#xA;&lt;p&gt;In this first episode of the blog post series I would like to show how&#xA;to start testing a REST API using ScalaTest and how to use some more&#xA;advanced features of this one of the most popular Scala-based test frameworks.&lt;/p&gt;&#xA;&lt;h2 id=&#34;setting-up-scalatest-test-project&#34;&gt;Setting up ScalaTest test project.&lt;/h2&gt;&#xA;&lt;p&gt;Scala is a JVM based language so we will need to have JDK installed (I usually use&#xA;the latest LTS release &amp;ndash; 21 at the time of writing this article).&lt;/p&gt;&#xA;&lt;p&gt;We would also use &lt;a href=&#34;https://www.scala-sbt.org/&#34;&gt;SBT&lt;/a&gt; &amp;ndash; the most popular build tools&#xA;for Scala projects.&lt;/p&gt;&#xA;&lt;p&gt;After installing both we can start a new ScalaTest project from scratch&#xA;using following in your command line:&lt;/p&gt;&#xA;&lt;p&gt;&lt;code&gt;sbt new scala/scalatest-example.g8&lt;/code&gt; &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&#xA;&lt;p&gt;You can also clone the GitHub repository with the code presented&#xA;in this article: &lt;a href=&#34;https://github.com/kkomorowski/scalatest-getting-started&#34;&gt;https://github.com/kkomorowski/scalatest-getting-started&lt;/a&gt;&lt;/p&gt;&#xA;&lt;h2 id=&#34;some-gherkin-please&#34;&gt;Some Gherkin, please!&lt;/h2&gt;&#xA;&lt;p&gt;The clue of the Behavior-Driven Development are the well defined test&#xA;scenarios that might be used as the documentation of the system. ScalaTest&#xA;is a very versatile test framework that gives the possibility of&#xA;choosing the test style that best suites your needs.&lt;/p&gt;&#xA;&lt;p&gt;In the example we&amp;rsquo;ll use &lt;code&gt;FeatureSpec&lt;/code&gt; and &lt;code&gt;GivenWhenThen&lt;/code&gt; from ScalaTest&#xA;to describe the scenarios of our tested feature using Gherkin-like DSL:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;class GitHubUserSpec extends AnyFeatureSpec with GivenWhenThen:&#xA;&#xA;  Feature(&amp;quot;GitHub User Profile&amp;quot;):&#xA;&#xA;    info(&amp;quot;As a programmer&amp;quot;)&#xA;    info(&amp;quot;I want to check the user profile presence&amp;quot;)&#xA;    info(&amp;quot;So I know if I can create an account with a given name&amp;quot;)&#xA;&#xA;    Scenario(&amp;quot;GitHub User Exists&amp;quot;):&#xA;      Given(&amp;quot;a GitHub account exists&amp;quot;)&#xA;      When(&amp;quot;I send a request to the /user/{username} API endpoint&amp;quot;)&#xA;      Then(&amp;quot;I get the response with HTTP status code 200&amp;quot;)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;NOTE: The examples use the Scala 3&#xA;&lt;a href=&#34;https://docs.scala-lang.org/scala3/reference/other-new-features/indentation.html&#34;&gt;significant indentation&lt;/a&gt;.&#xA;This way of writing of ScalaTest scenarios even more resembles Cucumber &lt;code&gt;feature&lt;/code&gt; files to me.&lt;/p&gt;&#xA;&lt;h2 id=&#34;lets-make-a-request&#34;&gt;Let&amp;rsquo;s make a request!&lt;/h2&gt;&#xA;&lt;p&gt;Unlike Cucumber or JBehave our &lt;code&gt;Given When Then&lt;/code&gt; steps are purely informational&#xA;and does not bring any implementation of the test behind. We need to implement&#xA;the test code ourself.&lt;/p&gt;&#xA;&lt;p&gt;Let&amp;rsquo;s try to make a first request. Scala is highly compatible with Java&#xA;so we could use one of the well known API testing libraries like RestAssured but here I would like to&#xA;show you &lt;a href=&#34;https://sttp.softwaremill.com/en/stable/&#34;&gt;sttp&lt;/a&gt; &amp;ndash; a Scala-based library that&#xA;will send the HTTP request for us.&lt;/p&gt;&#xA;&lt;p&gt;Simply add this line to your &lt;code&gt;build.sbt&lt;/code&gt; project file:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;libraryDependencies += &amp;quot;com.softwaremill.sttp.client3&amp;quot; %% &amp;quot;core&amp;quot; % &amp;quot;3.9.3&amp;quot;&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;and import to easily use Java HTTP client from Scala code:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;import sttp.client3.quick.*&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p id=&#34;example-send-request&#34;&gt;Now we can fill up our scenario with the code:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;Scenario(&amp;quot;GitHub User Exists&amp;quot;):&#xA;  Given(&amp;quot;a GitHub account exists&amp;quot;)&#xA;  val username = &amp;quot;kkomorowski&amp;quot;&#xA;  When(&amp;quot;I send a request to the /user/{username} API endpoint&amp;quot;)&#xA;  val request = quickRequest.get(uri&amp;quot;https://api.github.com/users/$username&amp;quot;)&#xA;  val response = simpleHttpClient.send(request)&#xA;  Then(&amp;quot;I get the response with HTTP status code 200&amp;quot;)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;h2 id=&#34;-and-assert-on-the-response&#34;&gt;&amp;hellip; and assert on the response.&lt;/h2&gt;&#xA;&lt;p&gt;The only thing left is to assert on the response from the API.&#xA;We can use ScalaTest matchers to have the code more readable:&lt;/p&gt;&#xA;&lt;p&gt;Add &lt;code&gt;org.scalatest.matchers.must.Matchers&lt;/code&gt; to the imports and extend your&#xA;test class with &lt;code&gt;Matchers&lt;/code&gt; trait. Now we can write the assertion&#xA;the following way:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-scala&#34;&gt;  response.code mustBe StatusCode(200)&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;h2 id=&#34;running-your-first-tests&#34;&gt;Running your first tests&lt;/h2&gt;&#xA;&lt;p&gt;The test is ready to be run. You can run it easily from the IDE (IntelliJ IDEA&#xA;is able to do it when equipped with Scala plugin. VSCode needs Metals extension).&lt;/p&gt;&#xA;&lt;p&gt;To run the tests from the command line we can use &lt;code&gt;sbt&lt;/code&gt;, just write:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code&gt;sbt test&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;p&gt;in your command line.&lt;/p&gt;&#xA;&lt;p&gt;After few lines of the logs from the build stage you should see a simple&#xA;text base test report similar to this one:&lt;/p&gt;&#xA;&lt;pre&gt;&lt;code class=&#34;language-markdown&#34;&gt;[info] GitHubUserSpec:&#xA;[info] Feature: GitHub User Profile&#xA;[info]   As a programmer &#xA;[info]   I want to check the user profile presence &#xA;[info]   So I know if I can create an account with a given name &#xA;[info]   Scenario: GitHub User Exists&#xA;[info]     Given a GitHub account exists &#xA;[info]     When I send a request to the /user/{username} API endpoint &#xA;[info]     Then I get the response with HTTP status code 200&#xA;[info] Run completed in 1 second, 811 milliseconds.&#xA;[info] Total number of tests run: 1&#xA;[info] Suites: completed 1, aborted 0&#xA;[info] Tests: succeeded 1, failed 0, canceled 0, ignored 0, pending 0&#xA;[info] All tests passed.&#xA;&lt;/code&gt;&lt;/pre&gt;&#xA;&lt;h2 id=&#34;end-words&#34;&gt;End words&lt;/h2&gt;&#xA;&lt;p&gt;In this article we&amp;rsquo;ve written our acceptance tests of the REST API using ScalaTest.&#xA;Using &lt;code&gt;FeatureSpec&lt;/code&gt; and &lt;code&gt;GivenWhenThen&lt;/code&gt; trait we&amp;rsquo;ve been able describe&#xA;the test scenarios and add the logic code of the test using STTP library&#xA;to make the HTTP request and add a simple assertion on the result.&lt;/p&gt;&#xA;&lt;p&gt;I hope that this short guide gave you an inspiration to try ScalaTest&#xA;in your testing project and convinced you that it might not be that&#xA;hard to learn.&lt;/p&gt;&#xA;&lt;div class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;&#xA;&lt;hr&gt;&#xA;&lt;ol&gt;&#xA;&lt;li id=&#34;fn:1&#34;&gt;&#xA;&lt;p&gt;You can find an official guide on the Scala Language website:&#xA;&lt;a href=&#34;https://docs.scala-lang.org/getting-started/sbt-track/testing-scala-with-sbt-on-the-command-line.html&#34;&gt;https://docs.scala-lang.org/getting-started/sbt-track/testing-scala-with-sbt-on-the-command-line.html&lt;/a&gt;.&amp;#160;&lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;&#xA;&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;/div&gt;</description>
    </item>
  </channel>
</rss>