<!DOCTYPE html data-theme="light">
<html lang="en-us" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>REST API Testing with Scalatest - Matchers | hiquality.dev</title>

      <link rel="stylesheet" href="/css/main.min.3c91d2077a8e3cfc0d2ebb92d7f760302bae6d17ebb3f9000e25dc543d7edcf1.css" integrity="sha256-PJHSB3qOPPwNLruS1/dgMCuubRfrs/kADiXcVD1&#43;3PE=" crossorigin="anonymous">


      <script src="/js/main.f2979a93a325fecf9605263bd141398a311c8e23388ed7dcff74f92f7e632866.js" integrity="sha256-8peak6Ml/s&#43;WBSY70UE5ijEcjiM4jtfc/3T5L35jKGY=" crossorigin="anonymous"></script>


<link rel="icon" type="image/png" sizes="64x64" href="/favicon.png">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/scala.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/bash.min.js"></script>
<script>hljs.highlightAll();</script>

</head>
<body>
  <header>
    <div id="topbar">
<div id="logo">
  <a href="https://hiquality.dev/">
    <img src="/logo.svg" alt="hiquality.dev logo - blue circle with handwritten 'hi!'"/>
  </a>
<h1>hiquality.dev</h1>
</div>    

<div id="navigation">
  <nav>
    <ul>
    <li>
      <a href="/">Home</a>
    </li>
    <li>
      <a aria-current="true" class="ancestor" href="/posts/">Posts</a>
    </li>
    <li>
      <a href="/about/">About</a>
    </li>
    </ul>
  </nav>
</div>

<button type="button" data-theme-toggle aria-label="Change to light theme">
  <svg>
    <use href="/icons/icons.svg#theme-toggle"></use>
  </svg>
</button>
</div>
  </header>
  <main>
    
  <article><h1><a href="/posts/rest-api-testing-with-scalatest-matchers/">REST API Testing with Scalatest - Matchers</a></h1>

<p class="published_at">
    
    
    <time datetime="2024-04-02T21:00:00&#43;02:00">April 2, 2024</time>
    | 
    
    Reading time: 4 minutes.
</p>


  <div id="terms">
    <ul>
        <li><a href="/tags/testing/">Testing</a></li>
        <li><a href="/tags/scala/">Scala</a></li>
        <li><a href="/tags/bdd/">BDD</a></li>
        <li><a href="/tags/tutorial/">Tutorial</a></li>
    </ul>
  </div>


  
    <div id="feature-image">
      
      
        <img alt="" src="https://images.unsplash.com/photo-1622227920933-7fcd7377703f?q=80&amp;w=1000&amp;h=500&amp;fit=crop" />
      
    </div>
  
  <p>In the <a href="https://hiquality.dev/posts/automated-acceptance-tests-with-scalatest/">previous post</a>
I&rsquo;ve described how to start with test automation of the REST API using ScalaTest.
Today I would like to show some more examples of using ScalaTest matchers - a smart
way of writing more readable assertions.</p>
<!-- more -->
<h2 id="string-matchers">String matchers</h2>
<p>Let&rsquo;s get back for a while to our
<a href="https://hiquality.dev/posts/automated-acceptance-tests-with-scalatest/#example-send-request">previous code example</a>.
Our test seems still a bit unfinished as we have no assertions on the response body.
ScalaTest has few methods defined called matchers which will give us nice looking assertions
on the different data types.</p>
<h3 id="startwith-endwith-include">startWith, endWith, include</h3>
<p>First, we&rsquo;ll check simple assertions working on Strings:</p>
<p>The response body must contain the blog name:</p>
<pre><code class="language-scala">response.body must include(&quot;https://hiquality.dev&quot;)
</code></pre>
<p>The body must also start and end with braces:</p>
<pre><code class="language-scala">response.body must startWith(&quot;{&quot;)
response.body must endWith(&quot;}&quot;)
</code></pre>
<h3 id="regular-expressions">Regular expressions</h3>
<p>We can also check if the response body matches a regular expression:</p>
<pre><code class="language-scala">response.body must fullyMatch regex &quot;&quot;&quot;.*&quot;blog&quot;:&quot;(https://)?hiquality\.dev&quot;.*&quot;&quot;&quot;
</code></pre>
<h2 id="parsing-a-response-to-json">Parsing a response to JSON</h2>
<p>Checking the response body as string might be a bit too verbose.
Of course there is a better way to do it: we&rsquo;ll parse the response body to a Scala object.</p>
<p>In this example I&rsquo;ve chosen <a href="%22https://circe.github.io/circe/%22">Circe</a> -
one of the most popular JSON libraries for Scala.</p>
<p>Let&rsquo;s add some dependencies to <code>build.sbt</code>:</p>
<pre><code class="language-scala">val circeVersion = &quot;0.14.6&quot;
libraryDependencies += &quot;io.circe&quot; %% &quot;circe-core&quot; % circeVersion
libraryDependencies += &quot;io.circe&quot; %% &quot;circe-generic&quot; % circeVersion
libraryDependencies += &quot;io.circe&quot; %% &quot;circe-parser&quot; % circeVersion
</code></pre>
<p>We&rsquo;ll use also sttp&rsquo;s Circe integration:</p>
<pre><code class="language-scala">libraryDependencies += &quot;com.softwaremill.sttp.client3&quot; %% &quot;circe&quot; % &quot;3.9.3&quot;
</code></pre>
<p>First we&rsquo;ll define a <code>GitHubUserProfile</code> case class:</p>
<pre><code class="language-scala">case class GitHubUserProfile(
    login: String,
    id: Int,
    name: String,
    company: Option[String],
    blog: String
)
</code></pre>
<p>and pass it as a type parameter to the decoder in the request definition:</p>
<pre><code class="language-scala">val request = quickRequest
    .get(uri&quot;https://api.github.com/users/kkomorowski&quot;)
    .response(asJson[GitHubUserProfile])
</code></pre>
<p>In the previous example the response body had type <code>String</code>.
This time it is different and - the client returns
<code>Either[ResponseException[String, circe.Error], GitHubUserProfile]</code>.
If parsing the response body fails, we&rsquo;ll get an exception on the
left side of the <code>Either</code>, otherwise we&rsquo;ll get the parsed object on the right side.</p>
<p>We can now check if the response was successful and safely extract the value from the <code>Either</code>
and assert on the fields of the object:</p>
<pre><code class="language-scala">response.body.isRight must be(true)
val user = response.body.toOption.get
user.blog must be(&quot;https://hiquality.dev&quot;)
</code></pre>
<p>The problem with this code snippet is when the first assertion fails, we&rsquo;ll get quite
unpleasant error on the logs:</p>
<pre><code class="language-text">false was not equal to true
ScalaTestFailureLocation: GitHubUserSpec at (GitHubUserSpec.scala:49)
Expected :true
Actual   :false
</code></pre>
<p>Except for the file and line number in the stack trace this gives not much
clue what was the reason for failure. If we skip the assertion here, we could
end up in even more cumbersome <code>NoSuchElementException</code>.</p>
<h2 id="eithervalues-trait">EitherValues trait</h2>
<p>Fortunately ScalaTest provides a handy <code>EitherValues</code> trait that makes
it easier to work with <code>Either</code> values.</p>
<p>Let&rsquo;s import it and use it in our test:</p>
<pre><code class="language-scala">import org.scalatest.EitherValues
</code></pre>
<p>and mix-in it by extending our test class.</p>
<p>We can now write our previous assertion the following way:</p>
<pre><code class="language-scala">val user = response.body.value
user.blog must be(&quot;https://hiquality.dev&quot;)
</code></pre>
<p>The <code>value</code> implicit conversion is used to extract the value
from the <code>Either</code> and to assert on it.</p>
<p>We can also assert on the left side of the <code>Either</code> if the parsing of the response body fails:</p>
<pre><code class="language-scala">response.body.left.value mustBe a [ResponseException[_, _]]
</code></pre>
<p>In the example above we&rsquo;ve asserted not on the value but on the type of the left side of the <code>Either</code>.</p>
<p>Similar traits as <code>EitherValues</code> exist for <code>Option</code> and <code>Try</code> types.</p>
<h2 id="matcher-negations">Matcher negations</h2>
<p>We can also easily negate the matcher by using a <code>not</code> word in our matcher.</p>
<pre><code class="language-scala">user.blog must not be empty
</code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>In this blog post we&rsquo;ve learned how to parse an HTTP response body to
Scala case class using Circe. We&rsquo;ve tried different ways of writing
the assertions in the test and have more readable error messages
for the failed assertions thanks to <code>EitherValue</code> trait provided by
ScalaTest.</p>
<p>Thanks for reading this article and see you in the next episode
of ScalaTest series.</p>

  
  </article>

  </main>
  <footer>
    <div id="icons">
    <a href="https://mastodon.social/@kkomorowski" title="My Mastodon profile">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none"><path d="M24 0v24H0V0h24ZM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036c-.01-.003-.019 0-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.016-.018Zm.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01l-.184-.092Z"/><path fill="currentColor" d="M16.431 2.415a5.109 5.109 0 0 1 4.164 4.142c.431 2.361.528 4.682.04 7.108c-.406 2.023-2.006 3.532-4.01 3.893c-1.55.278-3.105.424-4.667.42c.722.144 1.471.17 2.21.186l.632.012l.395.002c.536.007 1.097.048 1.533.34c.266.178.535.51.533.985c0 .429-.231.732-.364.878c-.468.513-1.19.784-1.832.994c-1.042.339-2.46.6-4.06.607c-3.428.016-6.644-2.263-7.478-5.75c-.749-3.133-.743-6.648-.145-9.781a5.03 5.03 0 0 1 4.094-4.02a25.859 25.859 0 0 1 8.956-.016ZM7.822 4.4a3.03 3.03 0 0 0-2.475 2.424c-.552 2.89-.55 6.117.125 8.942c.602 2.514 2.951 4.227 5.523 4.215c.234 0 .462-.008.684-.02a5.862 5.862 0 0 1-2.959-1.498c-.519-.495-1.115-1.254-.791-2.014c.201-.471.702-.721 1.2-.657c2.383.31 4.759.224 7.142-.204c1.223-.22 2.165-1.127 2.404-2.318c.426-2.119.35-4.177-.047-6.355a3.109 3.109 0 0 0-2.537-2.53a23.858 23.858 0 0 0-8.269.015ZM14 6a3 3 0 0 1 3 3v4a1 1 0 1 1-2 0V9a1 1 0 1 0-2 0v3a1 1 0 1 1-2 0V9a1 1 0 1 0-2 0v4a1 1 0 1 1-2 0V9a3 3 0 0 1 5-2.236A2.989 2.989 0 0 1 14 6Z"/></g></svg>
    </a>
    <a href="https://github.com/kkomorowski" title="My GitHub profile">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none"><path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"/><path fill="currentColor" d="M6.315 6.176c-.25-.638-.24-1.367-.129-2.034a6.77 6.77 0 0 1 2.12 1.07c.28.214.647.283.989.18A9.343 9.343 0 0 1 12 5c.961 0 1.874.14 2.703.391c.342.104.709.034.988-.18a6.77 6.77 0 0 1 2.119-1.07c.111.667.12 1.396-.128 2.033c-.15.384-.075.826.208 1.14C18.614 8.117 19 9.04 19 10c0 2.114-1.97 4.187-5.134 4.818c-.792.158-1.101 1.155-.495 1.726c.389.366.629.882.629 1.456v3a1 1 0 0 0 2 0v-3c0-.57-.12-1.112-.334-1.603C18.683 15.35 21 12.993 21 10c0-1.347-.484-2.585-1.287-3.622c.21-.82.191-1.646.111-2.28c-.071-.568-.17-1.312-.57-1.756c-.595-.659-1.58-.271-2.28-.032a9.081 9.081 0 0 0-2.125 1.045A11.432 11.432 0 0 0 12 3c-.994 0-1.953.125-2.851.356a9.08 9.08 0 0 0-2.125-1.045c-.7-.24-1.686-.628-2.281.031c-.408.452-.493 1.137-.566 1.719l-.005.038c-.08.635-.098 1.462.112 2.283C3.484 7.418 3 8.654 3 10c0 2.992 2.317 5.35 5.334 6.397A3.986 3.986 0 0 0 8 17.98l-.168.034c-.717.099-1.176.01-1.488-.122c-.76-.322-1.152-1.133-1.63-1.753c-.298-.385-.732-.866-1.398-1.088a1 1 0 0 0-.632 1.898c.558.186.944 1.142 1.298 1.566c.373.448.869.916 1.58 1.218c.682.29 1.483.393 2.438.276V21a1 1 0 0 0 2 0v-3c0-.574.24-1.09.629-1.456c.607-.572.297-1.568-.495-1.726C6.969 14.187 5 12.114 5 10c0-.958.385-1.881 1.108-2.684c.283-.314.357-.756.207-1.14Z"/></g></svg>
    </a>
    <a href="https://www.linkedin.com/in/krzysztof-komorowski-4194155" title="My LinkedIn profile">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="none"><path d="M24 0v24H0V0h24ZM12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035c-.01-.004-.019-.001-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.017-.018Zm.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01l-.184-.092Z"/><path fill="currentColor" d="M18 3a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H6a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h12Zm0 2H6a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1ZM8 10a1 1 0 0 1 .993.883L9 11v5a1 1 0 0 1-1.993.117L7 16v-5a1 1 0 0 1 1-1Zm3-1a1 1 0 0 1 .984.821a5.82 5.82 0 0 1 .623-.313c.667-.285 1.666-.442 2.568-.159c.473.15.948.43 1.3.907c.315.425.485.942.519 1.523L17 12v4a1 1 0 0 1-1.993.117L15 16v-4c0-.33-.08-.484-.132-.555a.548.548 0 0 0-.293-.188c-.348-.11-.849-.052-1.182.09c-.5.214-.958.55-1.27.861L12 12.34V16a1 1 0 0 1-1.993.117L10 16v-6a1 1 0 0 1 1-1ZM8 7a1 1 0 1 1 0 2a1 1 0 0 1 0-2Z"/></g></svg>
    </a>
    <a href="https://hiquality.dev/index.xml" title="Subscribe RSS Feed">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <g fill="none">
            <path d="M24 0v24H0V0h24ZM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036c-.01-.003-.019 0-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427c-.002-.01-.009-.017-.016-.018Zm.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092c.012.004.023 0 .029-.008l.004-.014l-.034-.614c-.003-.012-.01-.02-.02-.022Zm-.715.002a.023.023 0 0 0-.027.006l-.006.014l-.034.614c0 .012.007.02.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01l-.184-.092Z"/>
            <path fill="currentColor" d="M18 3a3 3 0 0 1 2.995 2.824L21 6v12a3 3 0 0 1-2.824 2.995L18 21H6a3 3 0 0 1-2.995-2.824L3 18V6a3 3 0 0 1 2.824-2.995L6 3h12Zm0 2H6a1 1 0 0 0-.993.883L5 6v12a1 1 0 0 0 .883.993L6 19h12a1 1 0 0 0 .993-.883L19 18V6a1 1 0 0 0-.883-.993L18 5Zm-9.5 9a1.5 1.5 0 1 1 0 3a1.5 1.5 0 0 1 0-3ZM8 10.5a5.5 5.5 0 0 1 5.5 5.5a1 1 0 1 1-2 0A3.5 3.5 0 0 0 8 12.5a1 1 0 1 1 0-2ZM8.5 7a8.5 8.5 0 0 1 8.481 9.066a1 1 0 1 1-1.995-.132a6.5 6.5 0 0 0-6.92-6.92a1 1 0 1 1-.132-1.995C8.121 7.006 8.31 7 8.5 7Z"/>
        </g>
    </svg>
    </a>
</div>
<p>&copy; 2024 Krzysztof Komorowski. This work is published under <a href="https://creativecommons.org/licenses/by/4.0/deed">CC BY 4.0 licence</a>.</p>

  </footer>
</body>
<script src="/js/theme-toggle.js"></script>
</html>
